[env:genericSTM32F407VGT6]
platform = ststm32
board = genericSTM32F407VGT6
framework = arduino

; --- UPLOAD SETTINGS (ST-Link V2) ---
upload_protocol = stlink

; If upload fails (e.g. "Target not found"), uncomment the lines below 
; to force "Connect Under Reset". Requires the RST pin to be connected.
; upload_flags =
;     -c
;     reset_config srst_only srst_nogate

; --- DEBUG SETTINGS ---
debug_tool = stlink
; Changed -O0 to -Og. -O0 is too slow for EtherCAT/Steppers.
; -Og optimizes for debugging so you can still see variables.
debug_build_flags = -Og -g -ggdb

; --- MONITOR SETTINGS ---
; Reminder: ST-Link V2 does NOT transmit Serial.print(). 
; You must use a USB-TTL adapter connected to your Serial pins.
monitor_speed = 115200
monitor_port = COM4  ; Make sure this matches your USB-TTL adapter's port
;monitor_filters = send_on_enter, time, colorize, log2file

; --- BUILD FLAGS ---
build_flags = 
    -Wl,--no-warn-rwx-segment
    -Ilib/soes/include/sys/gcc
    -D HAL_TIM_MODULE_ENABLED   ; Essential for your manual Timer register access
    -D HSE_VALUE=8000000U       ; 8MHz Crystal frequency per your schematic

lib_deps = 
    SPI
    rlogiacco/CircularBuffer
